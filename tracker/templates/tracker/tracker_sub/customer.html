{# Template for displaying individual customer info #}
{% load static %}
{% load num_filters %}
<table>
	<thead>
		<tr>
			{% for item in headers %}
				<th>{{ item }}</th>
			{% endfor item %}
		</tr>
	</thead>
	<tbody>
		<tr>
			<td id="name_cell">{{ customer.name }}</td>
			<td id="account_cell">#{{ customer.acct }}</td>
			<td id="email_cell">{{ customer.email }}</td>
			<td id="status_cell">{{ customer.get_status_display }}</td>
			<td id="open_date">{{ customer.createdate|date:"M d, Y" }}</td>
			{% if customer.status == '0' %}
				<td id="close_date">{{ customer.closedate|date:"M d, Y" }}</td>
			{% endif %}
		</tr>
	</tbody>
</table>
<br/>
{% if user.is_authenticated %}
	<div id="acctForm" style="display: none; width: 80%;">
		<form id="acct_info" method="post" action="/acct_info?acct={{ customer.acct }}">
			{% csrf_token %}
			<div class="col-3">
				Name: <input type="text" name="name" value="{{ customer.name }}" /><br />
				Account: <input type="text" name="acct" value="{{ customer.acct }}" /><br />
				Email: <input type="email" name="email" value="{{ customer.email }}" />
			</div>
			<div class="col-3">
				Notes:<br/> <textarea id = "notes">{{ customer.notes }}</textarea>
			</div>
			<div class="col-3">
				<button class="btn" name="submit">Submit Information</button>
			</div>
		</form>
	</div>
{% endif %}
<hr width="85%" align="left">
<a href="/inventory?acct={{ customer.acct }}&status=stored">Manage Inventory</a>
| <a href="/inventory?acct={{ customer.acct }}&status=all">Inventory Report</a>
{% if storage_fees %}
	| Daily storage fees as of today: ${{ storage_fees|length:"2" }}<br/>
{% else %}
	| Daily storage fees as of today: $0.00<br/>
{% endif %}

<br/><table>
	<thead>
		<tr>
			<th>&nbsp;</th>
			{% for item in inv_headers %}
				<th>{{ item }}</th>
			{% endfor %}
		</tr>
	</thead>
	<tbody>
		{% if shipment_list %}
			{% for shipment in shipment_list %}
				<tr id="ship_head_row">
					<td class="ship_toggle" onclick="toggleSection(this);">
						<a href="#">-</a>
					</td>
					<td><a href="/shipment?id={{ shipment.id }}">{{ shipment.id }}</a> ({{ shipment.inventory_set.count }})</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
					<td>${{ shipment.inventory_set.all|storage_fee_total }}</td>
					<td>{{ shipment.get_status_display }}</td>
					<td>{{ shipment.arrival|date:"m-d-Y" }}</td>
				</tr>
				{% for item in shipment.inventory_set.all %}
					<tr>
						<td>&nbsp;</td> <!-- Toggle -->
						<td><p style="visibility:hidden;">{{ shipment.id }}</p></td>
						<td><a href="/inventory?item={{ item.itemid }}">{{ item.itemid }}</a></td>
						<td>{{ item.volume|length:"2" }}</td>
						<td>${{ item.storage_fees|length:"2" }}</td>
						<td>{{ item.get_status_display }}</td>
						<td>{{ shipment.arrival|date:"m-d-Y" }}</td>
					</tr>
				{% endfor %}
			{% endfor %}
		{% endif %}
	</tbody>
</table>

<script>
var oldEvt = window.onload;
window.onload = function () {
	if (oldEvt) oldEvt();

	var custStatus = parseInt('{{ customer.status }}');

	var t = document.getElementsByClassName('float_user-greeting')[0].children[3].innerText;
	if (t == 'Log in' || custStatus == 0) {
		disableElements('acctForm');
	}
}
</script>